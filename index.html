<html>
  <head>
    <title>App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bowlby+One&display=swap" rel="stylesheet">
    <style>
      body {
        margin:0;
        padding:0;
        background: linear-gradient(0deg, #FC466B 0%, #3F5EFB 100%);
        color:#fff;
        font-family:"Bowlby One"
      }
      main {
        display:flex;
        justify-content:center;
        align-items:center;
        flex-direction: column;
        width:100vw;
        height:100vh;
      }
      #board {
        list-style:none;
        margin:0;
        padding:0;
        display:flex;
        flex-wrap:wrap;
        width:350px;
      }

      #board li {
        width:64px;
        height:64px;
        margin:2px;
        background:rgba(0,0,0,.5);
        border-bottom:3px solid rgba(0,0,0,.4);
        border-radius:8px;
        display:flex;
        justify-content:center;
        align-items:center;
        cursor:pointer;
        text-transform:uppercase;
        font-size:2rem;
        transition:0.3s all;
      }

      #board li.win {
        background:#000;
        color:#fff;
      }

    </style>
  </head>
  <body>
    <main>
      <h1 id="score">0</h1>
      <ul id="board"></ul>
    </main>

    <script>
      const gameboard = document.getElementById('board');

      let gameitems = '';

      const letterArray = [
        'a',
        'b',
        'c',
        'd',
        'e',
        'f',
        'g',
        'h',
        'i',
        'j',
        'k',
        'l',
        'm',
        'n',
        'o',
        'p',
        'q',
        'r',
        's',
        't',
        'u',
        'v',
        'w',
        'x',
        'y',
        'z'
      ]

      function checkWords() {
        const gameList = Array.from(gameboard.children);
        for(i=0; i < 25; i+=6) {

          // check rows
          const rowItems = gameList.filter((item,index) => {
            if (getRow(index) === getRow(i)) {
              return item;
            }
          });

          const word = rowItems.map(item => item.innerHTML).join('');

          const correctWords = wordlist.filter((item) => {
            if (item === word) {
              return item;
            }
          });

          if(correctWords.length) {
            console.log(correctWords);
            console.log(rowItems);

            // update score ..add 1
            updateScore();

            // add win class to winning row/col
            const updGameList = gameList.map((item) => {
              if (rowItems.includes(item)) {
                item.classList.add('win');
              }
            })

            //set timeout to replace items.
            setTimeout(() => {
              for(item of rowItems) {
                item.classList.remove('win');
              }
            }, 100)

            setTimeout(() => {
              for(item of rowItems) {
                randomLetter = letterArray[Math.floor(Math.random()*25)];
                item.id = randomLetter;
                item.innerHTML = randomLetter;
              }
            checkWords();
            }, 100)

          }

        }
      }

      for(let i=0; i < 25; i++) {
        randomLetter = letterArray[Math.floor(Math.random()*26)];
        gameitems = gameitems + `
          <li id="${randomLetter}">${randomLetter}</li>
        `;
      }

      gameboard.innerHTML = gameitems;

      const getCol = (val) => {
        const col = (val % 5) + 1;
        return col;
      }

      const getRow = (val) => {
        const row = Math.floor(val / 5);
        return row;
      }

      function arraymove(arr, fromIndex, toIndex) {
        var element = arr[fromIndex];
        arr.splice(fromIndex, 1);
        arr.splice(toIndex, 0, element);
      }

      const getArrayHandler = (tar,dir) => {
        console.log(dir);
        const gameList = Array.from(gameboard.children);

        const col = getCol(gameList.indexOf(tar));
        const row = getRow(gameList.indexOf(tar));

        const colItems = gameList.filter((item,index) => {
          if (getCol(index) === col) {
            return item;
          }
        });

        const rowItems = gameList.filter((item,index) => {
          if (getRow(index) === row) {
            return item;
          }
        });

        let indexReplace = 0;
        let indexStart = 0;
        if(dir === 'left') {
          indexStart = gameList.indexOf(rowItems[0])
          indexReplace = gameList.indexOf(rowItems[rowItems.length-1])
          arraymove(gameList,indexStart,indexReplace);
        }
        if(dir === 'right') {
          indexStart = gameList.indexOf(rowItems[rowItems.length-1])
          indexReplace = gameList.indexOf(rowItems[0])
          arraymove(gameList,indexStart,indexReplace);
        }
        if(dir === 'down') {
          for (const item of colItems) {
            indexStart = gameList.indexOf(item);
            if (indexStart+5 >= gameList.length) {
              indexReplace = indexStart+5 - gameList.length;
            } else {
              indexReplace = indexStart + 5;
            }
            arraymove(gameList,indexStart,indexReplace);
          }
        }
        if(dir === 'up') {
          for (let i = 0; i < colItems.length; i++) {
            indexStart = gameList.indexOf(colItems[i]);
            if ((indexStart+i-5) < 0) {
              indexReplace = gameList.length - 5 + indexStart;
            } else {
              indexReplace = indexStart+1 - 5;
            }
            arraymove(gameList,indexStart,indexReplace);
          }
        }

        let gameitems = '';
        for(item of gameList) {
          gameitems = gameitems + `<li id="item.id">${item.innerHTML}</li>`;
        }

        gameboard.innerHTML = gameitems;

        checkWords();

      }

      const leftMove = (event) => getArrayHandler(event, "left");
      const rightMove = (event) => getArrayHandler(event, "right");
      const downMove = (event) => getArrayHandler(event, "down");
      const upMove = (event) => getArrayHandler(event, "up");

      let currTarget = '';

    let touchstartX = 0;
    let touchstartY = 0;
    let touchendX = 0;
    let touchendY = 0;

    // init
    let score = 0;

    function updateScore() {
      score = score + 1;
      document.getElementById("score").innerHTML = score;
    }

    function handleGesture(currTarget, touchstartX, touchstartY, touchendX, touchendY) {
        console.log(currTarget);
        const delx = touchendX - touchstartX;
        const dely = touchendY - touchstartY;
        let dir = ''
        if(Math.abs(delx) > Math.abs(dely)){
            if(delx > 0) getArrayHandler(currTarget, "right");
            else getArrayHandler(currTarget, "left");
        }
        if(Math.abs(delx) < Math.abs(dely)){
            if(dely > 0) getArrayHandler(currTarget, "down");
            else getArrayHandler(currTarget, "up");
        }
    }

    gameboard.addEventListener('touchstart', function(event) {
        event.preventDefault();
        currTarget = event.target;
        touchstartX = event.changedTouches[0].screenX;
        touchstartY = event.changedTouches[0].screenY;
    }, false);

    gameboard.addEventListener('touchend', function(event) {
        event.preventDefault();
        touchendX = event.changedTouches[0].screenX;
        touchendY = event.changedTouches[0].screenY;
        handleGesture(currTarget, touchstartX, touchstartY, touchendX, touchendY)
    }, false);


    </script>
    <script src="wordlist.js"></script>
  </body>
</html>